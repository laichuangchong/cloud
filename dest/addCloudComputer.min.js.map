{"version":3,"sources":["../js/controller/addCloudComputer.js"],"names":["private_cloud","controller","$scope","$rootScope","$http","$state","less_one_service","formData","computerCount","net_work","url","method","headers","then","response","console","log","data","limits","absolute","countData","count","instances","title","used","totalInstancesUsed","total","maxTotalInstances","unit","cores","totalCoresUsed","maxTotalCores","ram","totalRAMUsed","maxTotalRAMSize","changeConfig","flavorRef","coresChangeProgress","vcpus","ramChangeProgress","formSubmit","$event","preventDefault","security","networks","push","name","angular","forEach","value","key","uuid","id","server","imageRef","availability_zone","OS-DCF:diskConfig","security_groups","min_count","status","alert","go","forbidden","message","changeNetworkMark","changeNetwork","lessone","change"],"mappings":";AAGAA,cAAcC,WAAW,gCAA8B,UAAS,cAAa,SAAQ,UAAS,oBAAmB,SAASC,GAAOC,GAAWC,GAAMC,GAAOC;IAErJJ,EAAOK;QACHC,eAAc;QACdC;OAEJL;QACIM,KAAK;QACLC,QAAQ;QACRC,SAAST,EAAWS;OACrBC,KAAK,SAAUC;QACdC,QAAQC,IAAIF,EAASG,KAAKC,OAAOC;QACjC,IAAIC,IAAYN,EAASG,KAAKC,OAAOC;QACrCjB,EAAOmB;YACHC;gBACIC,OAAO;gBACPC,MAAMJ,EAAUK;gBAChBC,OAAON,EAAUO;gBACjBC,MAAM;;YAGVC;gBACIN,OAAO;gBACPC,MAAMJ,EAAUU;gBAChBJ,OAAON,EAAUW;gBACjBH,MAAM;;YAEVI;gBACIT,OAAO;gBACPC,MAAMJ,EAAUa,eAAe;gBAC/BP,OAAON,EAAUc,kBAAkB;gBACnCN,MAAM;;;OAIf,SAAUd;QACTC,QAAQC,IAAIF;QAGhBZ,EAAOiC,eAAe,SAAUC;QAC5BrB,QAAQC,IAAIoB,IACZlC,EAAOmC,sBAAsBD,EAAUE,OACvCpC,EAAOqC,oBAAoBH,EAAUJ,MAAM;OAI/C9B,EAAOsC,aAAa,SAASC;QACzBA,EAAOC;QACP,IAAIC,QAAeC;QAEhB1C,EAAOK,SAASoC,YACfA,EAASE;YACLC,MAAQ;YAGhBC,QAAQC,QAAQ9C,EAAOK,SAASE,UAAS,SAASwC,GAAMC;YACjDD,KACCL,EAASC;gBACLM,MAAQhD,EAAWM,SAASyC,GAAKE;;YAI7CrC,QAAQC,IAAI4B,IACZxC;YACIM,KAAK;YACLC,QAAQ;YACRC,SAAST,EAAWS;YACpBK;gBACIoC;oBACIP,MAAS5C,EAAOK,SAASuC;oBACzBQ,UAAapD,EAAOK,SAAS+C;oBAC7BlB,WAAclC,EAAOK,SAAS6B,UAAUgB;oBACxCG,mBAAqB;oBACrBC,qBAAqB;oBACrBC,iBAAmBd;oBACnBC,UAAWA;oBACXc,WAAaxD,EAAOK,SAASC;;;WAKtCK,KAAK,SAASC;YACbC,QAAQC,IAAIF,IACU,OAAnBA,EAAS6C,WACRC,MAAM,SACNvD,EAAOwD,GAAG;WAEhB,SAAS/C;YACP8C,MAAM9C,EAASG,KAAK6C,UAAUC;;OAItC7D,EAAO8D,oBAAoB;QACvB9D,EAAO+D,iBAAgB;OAE3B/D,EAAOgE,UAAU,SAASjD;QACtB,OAAOX,EAAiB6D,OAAOlD","file":"addCloudComputer.min.js","sourcesContent":["/**\n * Created by chenzhongying on 2018/1/11.\n */\nprivate_cloud.controller('addCloudComputerController',['$scope','$rootScope','$http','$state','less_one_service',function($scope,$rootScope,$http,$state,less_one_service){\n\n    $scope.formData = { //创建云主机数据\n        computerCount:1,\n        net_work : []\n    };\n    $http({   //计算和防火墙\n        url: '/api/nova_limits',\n        method: 'GET',\n        headers: $rootScope.headers\n    }).then(function (response) {\n        console.log(response.data.limits.absolute);\n        var countData = response.data.limits.absolute;\n        $scope.count = {\n            instances: {\n                title: '云主机',\n                used: countData.totalInstancesUsed,\n                total: countData.maxTotalInstances,\n                unit: '个'\n\n            },\n            cores: {\n                title: 'VCPUs',\n                used: countData.totalCoresUsed,\n                total: countData.maxTotalCores,\n                unit: '个'\n            },\n            ram: {\n                title: '内存',\n                used: countData.totalRAMUsed / 1024,\n                total: countData.maxTotalRAMSize / 1024,\n                unit: 'GB'\n            }\n        };\n\n    }, function (response) {\n        console.log(response);\n        // alert(response.data.error.message);\n    });\n    $scope.changeConfig = function (flavorRef) { //进度条\n        console.log(flavorRef);\n        $scope.coresChangeProgress = flavorRef.vcpus; //vcpus\n        $scope.ramChangeProgress = flavorRef.ram / 1024 ; //内存\n    };\n    \n\n    $scope.formSubmit = function($event){\n        $event.preventDefault();\n        var security = [], networks = []; //防火墙类型/网络类型\n        \n        if($scope.formData.security){\n            security.push ({\n                \"name\": \"default\"\n            });\n        }\n        angular.forEach($scope.formData.net_work,function(value,key){\n            if(value){\n                networks.push({\n                    \"uuid\": $rootScope.net_work[key].id\n                });\n            }\n        });\n        console.log(networks);\n        $http({\n            url: \"/api/list_servers/\", //添加云主机\n            method: 'POST',\n            headers: $rootScope.headers,\n            data:{\n                \"server\" : {\n                    \"name\" : $scope.formData.name,\n                    \"imageRef\" : $scope.formData.imageRef,\n                    \"flavorRef\" : $scope.formData.flavorRef.id,\n                    \"availability_zone\": \"nova\",\n                    \"OS-DCF:diskConfig\": \"AUTO\",\n                    \"security_groups\": security, //防火墙\n                    \"networks\":networks,//网络类型\n                    \"min_count\": $scope.formData.computerCount\n                }\n\n            }\n\n        }).then(function(response){\n            console.log(response);\n            if(response.status == 202){\n                alert('添加成功');\n                $state.go(\"count.cloudComputer\");\n            }\n        },function(response){\n            alert(response.data.forbidden.message);\n        });\n    };\n   \n    $scope.changeNetworkMark = function(){ //标示有无操作\n        $scope.changeNetwork = true;\n    };\n    $scope.lessone = function(data){\n        return less_one_service.change(data);\n\n    };\n\n}]);"]}