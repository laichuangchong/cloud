{"version":3,"sources":["../js/controller/addCloudComputer.js"],"names":["private_cloud","controller","$scope","$rootScope","$http","$state","less_one_service","count_service","formData","computerCount","net_work","getCount","changeConfig","flavorRef","console","log","coresChangeProgress","vcpus","ramChangeProgress","ram","formSubmit","$event","preventDefault","security","networks","push","name","angular","forEach","value","key","uuid","id","url","method","headers","data","server","imageRef","availability_zone","OS-DCF:diskConfig","security_groups","min_count","then","response","status","alert","go","statusText","changeNetworkMark","changeNetwork","lessone","change"],"mappings":";AAGAA,cAAcC,WAAW,gCAA8B,UAAS,cAAa,SAAQ,UAAS,oBAAmB,iBAAgB,SAASC,GAAOC,GAAWC,GAAMC,GAAOC,GAAiBC;IAEtLL,EAAOM;QACHC,eAAc;QACdC;OAEJH,EAAcI,YAEdT,EAAOU,eAAe,SAAUC;QAC5BC,QAAQC,IAAIF,IACZX,EAAOc,sBAAsBH,EAAUI,OACvCf,EAAOgB,oBAAoBL,EAAUM,MAAM;OAI/CjB,EAAOkB,aAAa,SAASC;QACzBA,EAAOC;QACP,IAAIC,QAAeC;QAEhBtB,EAAOM,SAASe,YACfA,EAASE;YACLC,MAAQ;YAGhBC,QAAQC,QAAQ1B,EAAOM,SAASE,UAAS,SAASmB,GAAMC;YACjDD,KACCL,EAASC;gBACLM,MAAQ5B,EAAWO,SAASoB,GAAKE;;YAI7ClB,QAAQC,IAAIS,IACZpB;YACI6B,KAAK;YACLC,QAAQ;YACRC,SAAShC,EAAWgC;YACpBC;gBACIC;oBACIX,MAASxB,EAAOM,SAASkB;oBACzBY,UAAapC,EAAOM,SAAS8B;oBAC7BzB,WAAcX,EAAOM,SAASK,UAAUmB;oBACxCO,mBAAqB;oBACrBC,qBAAqB;oBACrBC,iBAAmBlB;oBACnBC,UAAWA;oBACXkB,WAAaxC,EAAOM,SAASC;;;WAKtCkC,KAAK,SAASC;YACb9B,QAAQC,IAAI6B,IACU,OAAnBA,EAASC,WACRC,MAAM,SACNzC,EAAO0C,GAAG;WAEhB,SAASH;YACPE,MAAMF,EAASI;;OAIvB9C,EAAO+C,oBAAoB;QAEvB/C,EAAOgD,iBAAgB,GACvBpC,QAAQC,IAAIb,EAAOgD;OAGvBhD,EAAOiD,UAAU,SAASf;QACtB,OAAO9B,EAAiB8C,OAAOhB","file":"addCloudComputer.min.js","sourcesContent":["/**\n * Created by chenzhongying on 2018/1/11.\n */\nprivate_cloud.controller('addCloudComputerController',['$scope','$rootScope','$http','$state','less_one_service','count_service',function($scope,$rootScope,$http,$state,less_one_service,count_service){\n\n    $scope.formData = { //创建云主机数据\n        computerCount:1,\n        net_work : []\n    };\n    count_service.getCount();\n\n    $scope.changeConfig = function (flavorRef) { //进度条\n        console.log(flavorRef);\n        $scope.coresChangeProgress = flavorRef.vcpus; //vcpus\n        $scope.ramChangeProgress = flavorRef.ram / 1024 ; //内存\n    };\n    \n\n    $scope.formSubmit = function($event){\n        $event.preventDefault();\n        var security = [], networks = []; //防火墙类型/网络类型\n        \n        if($scope.formData.security){\n            security.push ({\n                \"name\": \"default\"\n            });\n        }\n        angular.forEach($scope.formData.net_work,function(value,key){\n            if(value){\n                networks.push({\n                    \"uuid\": $rootScope.net_work[key].id\n                });\n            }\n        });\n        console.log(networks);\n        $http({\n            url: \"/api/list_servers/\", //添加云主机\n            method: 'POST',\n            headers: $rootScope.headers,\n            data:{\n                \"server\" : {\n                    \"name\" : $scope.formData.name,\n                    \"imageRef\" : $scope.formData.imageRef,\n                    \"flavorRef\" : $scope.formData.flavorRef.id,\n                    \"availability_zone\": \"nova\",\n                    \"OS-DCF:diskConfig\": \"AUTO\",\n                    \"security_groups\": security, //防火墙\n                    \"networks\":networks,//网络类型\n                    \"min_count\": $scope.formData.computerCount\n                }\n\n            }\n\n        }).then(function(response){\n            console.log(response);\n            if(response.status == 202){\n                alert('添加成功');\n                $state.go(\"count.cloudComputer\");\n            }\n        },function(response){\n            alert(response.statusText);\n        });\n    };\n   \n    $scope.changeNetworkMark = function(){ //标示有无操作\n\n        $scope.changeNetwork = true;\n        console.log($scope.changeNetwork);\n    };\n    \n    $scope.lessone = function(data){\n        return less_one_service.change(data);\n\n    };\n\n}]);"]}