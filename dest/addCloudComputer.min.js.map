{"version":3,"sources":["../js/controller/addCloudComputer.js"],"names":["private_cloud","controller","$scope","$rootScope","$http","$state","formData","computerCount","net_work","url","method","headers","then","response","console","log","data","limits","absolute","countData","count","instances","title","used","totalInstancesUsed","total","maxTotalInstances","unit","cores","totalCoresUsed","maxTotalCores","ram","totalRAMUsed","maxTotalRAMSize","changeConfig","flavorRef","coresChangeProgress","vcpus","ramChangeProgress","formSubmit","$event","preventDefault","server","name","imageRef","id","availability_zone","OS-DCF:diskConfig","security_groups","networks","uuid","min_count","status","alert","go"],"mappings":";AAGAA,cAAcC,WAAW,gCAA8B,UAAS,cAAa,SAAQ,UAAS,SAASC,GAAOC,GAAWC,GAAMC;IAE3HH,EAAOI;QACHC,eAAc;QACdC;OAEJJ;QACIK,KAAK;QACLC,QAAQ;QACRC,SAASR,EAAWQ;OACrBC,KAAK,SAAUC;QACdC,QAAQC,IAAIF,EAASG,KAAKC,OAAOC;QACjC,IAAIC,IAAYN,EAASG,KAAKC,OAAOC;QACrChB,EAAOkB;YACHC;gBACIC,OAAO;gBACPC,MAAMJ,EAAUK;gBAChBC,OAAON,EAAUO;gBACjBC,MAAM;;YAGVC;gBACIN,OAAO;gBACPC,MAAMJ,EAAUU;gBAChBJ,OAAON,EAAUW;gBACjBH,MAAM;;YAEVI;gBACIT,OAAO;gBACPC,MAAMJ,EAAUa,eAAe;gBAC/BP,OAAON,EAAUc,kBAAkB;gBACnCN,MAAM;;;OAIf,SAAUd;QACTC,QAAQC,IAAIF;QAGhBX,EAAOgC,eAAe,SAAUC;QAC5BrB,QAAQC,IAAIoB,IACZjC,EAAOkC,sBAAsBD,EAAUE,OACvCnC,EAAOoC,oBAAoBH,EAAUJ,MAAM;OAI/C7B,EAAOqC,aAAa,SAASC;QACzBA,EAAOC,kBACPrC;YACIK,KAAK;YACLC,QAAQ;YACRC,SAASR,EAAWQ;YACpBK;gBACI0B;oBACIC,MAASzC,EAAOI,SAASqC;oBACzBC,UAAa1C,EAAOI,SAASsC;oBAC7BT,WAAcjC,EAAOI,SAAS6B,UAAUU;oBACxCC,mBAAqB;oBACrBC,qBAAqB;oBACrBC;wBAEQL,MAAQ;;oBAGhBM;wBAEQC,MAAQ;;oBAGhBC,WAAajD,EAAOI,SAASC;;;WAKtCK,KAAK,SAASC;YACbC,QAAQC,IAAIF,IACU,OAAnBA,EAASuC,WACRC,MAAM,SACNhD,EAAOiD,GAAG;WAEhB","file":"addCloudComputer.min.js","sourcesContent":["/**\n * Created by chenzhongying on 2018/1/11.\n */\nprivate_cloud.controller('addCloudComputerController',['$scope','$rootScope','$http','$state',function($scope,$rootScope,$http,$state){\n\n    $scope.formData = { //创建云主机数据\n        computerCount:1,\n        net_work : []\n    };\n    $http({   //计算和防火墙\n        url: '/api/nova_limits',\n        method: 'GET',\n        headers: $rootScope.headers\n    }).then(function (response) {\n        console.log(response.data.limits.absolute);\n        var countData = response.data.limits.absolute;\n        $scope.count = {\n            instances: {\n                title: '云主机',\n                used: countData.totalInstancesUsed,\n                total: countData.maxTotalInstances,\n                unit: '个'\n\n            },\n            cores: {\n                title: 'VCPUs',\n                used: countData.totalCoresUsed,\n                total: countData.maxTotalCores,\n                unit: '个'\n            },\n            ram: {\n                title: '内存',\n                used: countData.totalRAMUsed / 1024,\n                total: countData.maxTotalRAMSize / 1024,\n                unit: 'GB'\n            }\n        };\n\n    }, function (response) {\n        console.log(response);\n        // alert(response.data.error.message);\n    });\n    $scope.changeConfig = function (flavorRef) { //进度条\n        console.log(flavorRef);\n        $scope.coresChangeProgress = flavorRef.vcpus; //vcpus\n        $scope.ramChangeProgress = flavorRef.ram / 1024 ; //内存\n    };\n    \n    \n    $scope.formSubmit = function($event){\n        $event.preventDefault();\n        $http({\n            url: \"/api/list_servers/\", //添加云主机\n            method: 'POST',\n            headers: $rootScope.headers,\n            data:{\n                \"server\" : {\n                    \"name\" : $scope.formData.name,\n                    \"imageRef\" : $scope.formData.imageRef,\n                    \"flavorRef\" : $scope.formData.flavorRef.id,\n                    \"availability_zone\": \"nova\",\n                    \"OS-DCF:diskConfig\": \"AUTO\",\n                    \"security_groups\": [  //可选项防火墙\n                        {\n                            \"name\": \"default\"\n                        }\n                    ],\n                    \"networks\":[  //可选项\n                        {\n                            \"uuid\": \"80bee3ca-4981-4285-b682-943e77d7a4c7\"\n                        }\n                    ],\n                    \"min_count\": $scope.formData.computerCount\n                }\n\n            }\n\n        }).then(function(response){\n            console.log(response);\n            if(response.status == 202){\n                alert('添加成功');\n                $state.go(\"count.cloudComputer\");\n            }\n        },function(){\n\n        });\n    };\n\n}]);"]}