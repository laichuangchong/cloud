{"version":3,"sources":["../js/controller/backups.js"],"names":["private_cloud","controller","$scope","$state","$rootScope","$http","all_check_service","cloud_service","$timeout","backups","getCloud","cloud_promise","promise","then","response","console","log","clouds","data","servers","url","headers","angular","forEach","images","value","key","metadata","image_type","item","subvalue","subkey","id","server","cloudName","name","push","alert","statusText","all_check","allCheck","status","hostList","itemCheck","deleteBase","confirm","method","splice","formSubmit","event","preventDefault","selectCloud","createBackup","backupName","backup_type","rotation","$","modal","go","reload"],"mappings":";AAGAA,cAAcC,WAAW,uBAAsB,UAAU,UAAS,cAAa,SAAS,qBAAoB,iBAAgB,YAAW,SAAUC,GAAOC,GAAOC,GAAYC,GAAOC,GAAkBC,GAAcC;IAC9MN,EAAOO,cACPF,EAAcG,YACdN,EAAWO,cAAcC,QAAQC,KAAK,SAASC;QAC3CC,QAAQC,IAAIF,IACZZ,EAAOe,SAASH,EAASI,KAAKC,SAC9Bd;YACIe,KAAI;YACJC,SAASjB,EAAWiB;WACrBR,KAAK,SAASC;YACbC,QAAQC,IAAIF,IACZQ,QAAQC,QAAQT,EAASI,KAAKM,QAAO,SAASC,GAAMC;gBAChD,IAAgC,cAA7BD,EAAME,SAASC,cAAyD,YAA7BH,EAAME,SAASC,YAAuB;oBAChF,IAAIC,IAAOJ;oBACXH,QAAQC,QAAQrB,EAAOe,QAAO,SAASa,GAASC;wBACzCD,EAASE,MAAMP,EAAMQ,OAAOD,OAC3BH,EAAKK,YAAYJ,EAASK;wBAGlCjC,EAAOO,QAAQ2B,KAAKX;;;WAI9B,SAASX;YACPuB,MAAMvB,EAASwB;;QAKvBpC,EAAOqC,aAAY,GACnBxB,QAAQC,IAAId,EAAOqC,YACnBrC,EAAOsC,WAAW,SAAUC;QACxBnC,EAAkBkC,SAASC,GAAQvC,EAAOwC;OAE9CxC,EAAOyC,YAAY;QACfrC,EAAkBqC,UAAUzC;OAGhCA,EAAO0C,aAAa,SAAUT,GAAKH,GAAGN;QAC9BmB,QAAQ,SAASV,IAAO,kBACxB9B;YACIe,KAAK,sBAAoBY;YACzBc,QAAQ;YACRzB,SAASjB,EAAWiB;WACrBR,KAAK,SAAUC;YACdC,QAAQC,IAAIF,IACZuB,MAAM,SACNnC,EAAOO,QAAQsC,OAAOrB,GAAI;WAC5B,SAASZ;YACPuB,MAAMvB,EAASwB;;OAI3BpC,EAAO8C,aAAa,SAASC;QACzBA,EAAMC,kBACN7C;YACIe,KAAK,wBAAsBlB,EAAOiD;YAClCL,QAAQ;YACRzB,SAASjB,EAAWiB;YACpBH;gBACIkC;oBACIjB,MAAQjC,EAAOmD;oBACfC,aAAe;oBACfC,UAAY;;;WAGrB1C,KAAK,SAAUC;YACdC,QAAQC,IAAIF,IACZ0C,EAAE,iBAAiBC,MAAM,SACzBjD,EAAS;gBACLL,EAAOuD,GAAG;oBAAoBC,SAAO;;eACvC;WACJ,SAAS7C;YACPuB,MAAMvB,EAASwB","file":"backups.min.js","sourcesContent":["/**\n * Created by chenzhongying on 2018/1/5.\n */\nprivate_cloud.controller('backupsController', ['$scope', '$state','$rootScope','$http', 'all_check_service','cloud_service','$timeout',function ($scope,$state,$rootScope, $http, all_check_service,cloud_service,$timeout) {\n    $scope.backups = [];//备份列表\n    cloud_service.getCloud();\n    $rootScope.cloud_promise.promise.then(function(response){\n        console.log(response);\n        $scope.clouds = response.data.servers;\n        $http({\n            url:'/api/list_images/detail',\n            headers: $rootScope.headers\n        }).then(function(response){\n            console.log(response);\n            angular.forEach(response.data.images,function(value,key){\n                if(value.metadata.image_type == \"snapshot\" || value.metadata.image_type == \"backup\"){\n                    var item = value;\n                    angular.forEach($scope.clouds,function(subvalue,subkey){\n                        if(subvalue.id == value.server.id){\n                            item.cloudName = subvalue.name;\n                        }\n                    });\n                    $scope.backups.push(value);\n                }\n            });\n\n        },function(response){\n            alert(response.statusText);\n        });\n    });\n\n    \n    $scope.all_check = false; //全选按钮状态\n    console.log($scope.all_check);\n    $scope.allCheck = function (status) { //父选项\n        all_check_service.allCheck(status, $scope.hostList);\n    };\n    $scope.itemCheck = function () { //子选项\n        all_check_service.itemCheck($scope);\n\n    };\n    $scope.deleteBase = function (name,id,key) {\n        if (confirm('确定删除' + name + \"吗？这个动作不能撤消哦\")) {\n            $http({\n                url: \"/api/list_images/\"+id, //获取云主机列表\n                method: 'DELETE',\n                headers: $rootScope.headers\n            }).then(function (response) {\n                console.log(response);\n                alert('删除成功');\n                $scope.backups.splice(key,1);\n            },function(response){\n                alert(response.statusText);\n            });\n        }\n    };\n    $scope.formSubmit = function(event){ //提交表单\n        event.preventDefault();\n        $http({\n            url: \"/api/server_action/\"+$scope.selectCloud, //获取云主机列表\n            method: 'POST',\n            headers: $rootScope.headers,\n            data:{\n                \"createBackup\": {\n                    \"name\": $scope.backupName,\n                    \"backup_type\": \"daily\",\n                    \"rotation\": 1\n                }\n            }\n        }).then(function (response) {\n            console.log(response);\n            $('#creat_backup').modal('hide');\n            $timeout(function(){\n                $state.go('count.backups',{},{reload:true});\n            },1000);\n        },function(response){\n            alert(response.statusText);\n        });\n\n    };\n}]);"]}