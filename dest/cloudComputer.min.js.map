{"version":3,"sources":["../js/controller/cloudComputer.js"],"names":["private_cloud","controller","$scope","$state","$sce","$rootScope","$http","all_check_service","$q","$timeout","$window","$interval","$location","count_service","resetState","obj","data","vm","state","text","vm_state","task","task_state","power","power_state","reachImage","imageId","angular","forEach","images","value","key","id","imageName","name","reachFlover","i","flavors","length","flavor","url","path","getCount","searchCloud","warn","warnText","building","active","rescued","paused","suspended","stopped","soft_deleted","hard_deleted","resized","error","null","image_snapshotting","image_backingup","pausing","unpausing","suspending","resuming","deleting","stopping","starting","rescuing","unrescuing","rebuilding","powering_on","powering_off","resizing","resize_confirming","scheduling","block_device_mapping","networking","spawning","reboot_started_hard","rebuild_spawning","powering-off","resize_finish","resize_reverting","resize_migrated","resize_migrating","0","1","3","4","6","7","cloudHost","images_promise","promise","then","method","headers","response","servers","console","log","item","ipData","addresses","push","image","os-getVNCConsole","type","vnc","alert","statusText","success","server","cancel","$on","ngRepeatFinishedEvent","$","popover","html","content","vcpus","ram","disk","deleteCloud","cloudId","index","confirm","status","splice","restartComputer","reboot","all_check","allCheck","itemCheck","changeConfig","coresChangeProgress","newConfig","oldConfig","ramChangeProgress","showConfig","resetConfigInfo","info","canSelectFlavors","copy","flavorId","reachFloverIndex","submitConfig","diskConfig","resize","flavorRef","OS-DCF:diskConfig","modal","intervalConfig","confirmConfig","confirmResize","intervalConfirmConfig","go","reload","returnConfig","revertResize","reconstruction","selectImage","submitResetCloudComputer","rebuild","imageRef","intervalReconstruction","showCloud","cloud_name","indexOf","toggleComputer","json"],"mappings":"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","file":"cloudComputer.min.js","sourcesContent":["/**\n * Created by chenzhongying on 2018/1/5.\n */\nprivate_cloud.controller('cloudComputerController', ['$scope', '$state', '$sce', '$rootScope', '$http', 'all_check_service', '$q', '$timeout', '$window', '$interval', '$location', 'count_service', function ($scope, $state, $sce, $rootScope, $http, all_check_service, $q, $timeout, $window, $interval, $location, count_service) {\n    $scope.url = $location.path();\n    count_service.getCount();//主要获取云主机总数\n    $scope.searchCloud = ''; //搜索内容\n    $scope.warn = false;//警告框\n    $scope.warnText = [];//警告文字\n    $scope.vm_state = { //云主机状态\n        building: '创建中',\n        active: '运行中',\n        rescued: '灾备运行',\n        paused: '暂停',\n        suspended: '挂起',\n        stopped: '停止',\n        soft_deleted: '软删除',\n        hard_deleted: '应删除',\n        resized: '确认/回退(调整配置)? ',\n        error: '错误'\n    };\n    $scope.task_state = { //任务\n        null: '无',\n        building: '孵化',\n        image_snapshotting: '正在创建快照',\n        image_backingup: '备份',\n        pausing: '暂停',\n        unpausing: '暂停恢复',\n        suspending: '正在挂起',\n        resuming: '挂起恢复',\n        deleting: '正在删除',\n        stopping: '正在停止',\n        starting: '正在启动',\n        rescuing: '灾难恢复',\n        unrescuing: '灾难复原',\n        rebuilding: '正在重建',\n        powering_on: '打开电源',\n        powering_off: '关闭电源',\n        resizing: '调整配置',\n        resize_confirming: '配置调整确认',\n        scheduling: '调度',\n        block_device_mapping: '块设备映射',\n        networking: '网络映射',\n        spawning: '正在生成',\n        reboot_started_hard: '正在重启',\n        rebuild_spawning: '重建孵化中',\n        \"powering-off\": '正在关闭电源',\n        resize_finish: '已经重建',\n        resize_reverting: '调整撤销中',\n        \"resize_migrated\": '调整配置完毕',\n        \"resize_migrating\": '正在调整配置'\n    };\n    $scope.power_state = { //电池状态\n        0: '无',\n        1: '运行中',\n        3: '暂停',\n        4: '关闭',\n        6: '崩溃',\n        7: '挂起'\n    };\n    $scope.cloudHost = [];//云主机列表\n    function resetState(obj, data) { //更新数据\n        obj.vm = { //云主机状态\n            state: data['OS-EXT-STS:vm_state'],\n            text: $scope.vm_state[data['OS-EXT-STS:vm_state']]\n        };\n        obj.task = { //任务状态\n            state: data['OS-EXT-STS:task_state'],\n            text: $scope.task_state[data['OS-EXT-STS:task_state']]\n        };\n        obj.power = { //电源状态\n            state: data['OS-EXT-STS:power_state'],\n            text: $scope.power_state[data['OS-EXT-STS:power_state']]\n        };\n    }\n\n    function reachImage(obj, imageId) { //查找镜像名称\n        angular.forEach($rootScope.images, function (value, key) {\n            if (imageId == value.id) {\n                obj.imageName = value.name; //镜像名称\n            }\n        });\n    }\n\n    function reachFlover(obj) {  //查找配置\n        for (var i = 0; i < $rootScope.flavors.length; i++) {\n            if ($rootScope.flavors[i].id == obj.flavor.id) {\n                return $rootScope.flavors[i]; //配置\n            }\n        }\n    }\n\n    function reachFloverIndex(flavorId) {  //查找配置类型在数据中的位置\n        for (var i = 0; i < $rootScope.flavors.length; i++) {\n            if ($rootScope.flavors[i].id == flavorId) {\n                return i; //返回坐标\n            }\n        }\n    }\n\n    $rootScope.images_promise.promise.then(function () { //获取镜像之后执行\n        $http({\n            url: \"/api/list_servers/detail\", //获取云主机列表\n            method: 'GET',\n            headers: $rootScope.headers\n        }).then(function (response) {\n            var data = response.data.servers;\n            console.log(data);\n            angular.forEach(data, function (value, key) {\n                var item = {};\n                item.ipData = [];\n                angular.forEach(value.addresses, function (value, key) { //获取IP\n                    angular.forEach(value, function (value, key) {\n                        console.log(value);\n                        item.ipData.push(value);\n                    });\n                });\n                item.flavor = reachFlover(value); //配置类型\n                item.name = value.name; //云主机名称\n                item.id = value.id; //云主机id\n                var imageId = value.image.id; //镜像ID\n                resetState(item, value); //获取任务状态\n                reachImage(item, imageId); //查找备份名称\n\n                if (value['OS-EXT-STS:task_state'] == null) {\n                    $http({ //获取vnc地址\n                        url: '/api/server_action/' + value.id,\n                        method: 'POST',\n                        headers: $rootScope.headers,\n                        data: {\n                            \"os-getVNCConsole\": {\n                                \"type\": \"novnc\"\n                            }\n                        }\n\n                    }).then(function (response) {\n                        item.vnc = response.data.console.url;\n                    }, function (response) {\n                        alert(response.statusText);\n                    });\n\n                }\n\n                $scope.cloudHost.push(item);\n\n                if (value['OS-EXT-STS:task_state'] != null) { //如果有任务正在执行那就要监听这个任务状态\n                    $scope['intervalInit' + key] = $interval(function () {\n                        $http({\n                            url: '/api/list_servers/' + item.id,\n                            method: 'GET',\n                            headers: $rootScope.headers\n                        }).then(function (success) {\n                            console.log(success);\n                            var data = success.data.server;\n                            resetState($scope.cloudHost[key], data); //更新任务状态\n                            $scope.cloudHost[key].flavor = reachFlover(data); //更新配置\n                            if (data['OS-EXT-STS:task_state'] == null) {\n                                $scope.cloudHost[key].ipData = []; //IP地址初始化\n                                $scope.cloudHost[key].vnc = ''; //vnc地址初始化\n                                angular.forEach(data.addresses, function (value) { //获取IP\n                                    angular.forEach(value, function (value) {\n                                        $scope.cloudHost[key].ipData.push(value);\n                                        console.log($scope.cloudHost[key].ipData);\n                                    });\n                                });\n                                $interval.cancel($scope['intervalInit' + key]);\n                                $scope['intervalInit' + key] = null;\n                                $http({ //获取vnc地址\n                                    url: '/api/server_action/' + value.id,\n                                    method: 'POST',\n                                    headers: $rootScope.headers,\n                                    data: {\n                                        \"os-getVNCConsole\": {\n                                            \"type\": \"novnc\"\n                                        }\n                                    }\n\n                                }).then(function (response) {\n                                    $scope.cloudHost[key].vnc = response.data.console.url;\n                                }, function (response) {\n                                    alert(response.statusText);\n                                });\n                            }\n                        }, function (error) {\n                            alert(error.statusText);\n                        });\n                    }, 1000);\n                }\n                $scope.$on('ngRepeatFinished', function (ngRepeatFinishedEvent) {\n                    //you also get the actual event object\n                    //do stuff, execute functions -- whatever...\n                    $('#config' + key).popover({\n                        html: true,\n                        content: '<table class=\"table table-bordered table-striped table-condensed\">' +\n                        '<tbody>' +\n                        '<tr>' +\n                        '<td width=\"100px\">VCPUs</td>' +\n                        '<td width=\"100px\">' + item.flavor.vcpus +\n                        '</td>' +\n                        '</tr>' +\n                        '<tr>' +\n                        '<td>内存</td>' +\n                        '<td>' + item.flavor.ram / 1024 + '</td>' +\n                        '</tr>' +\n                        '<tr>' +\n                        '<td>大小</td>' +\n                        '<td>' + item.flavor.disk + '</td>' +\n                        '</tr>' +\n                        '</tbody>' +\n                        '</table>'\n                    });\n                });\n            });\n        }, function (response) {\n            alert(response.statusText);\n        });\n\n    });\n\n\n    $scope.deleteCloud = function (cloudId, name, index) { //删除云主机\n        if (confirm('您确定删除' + name + '吗？此操作不可恢复！')) {\n            $http({\n                url: '/api/list_servers/' + cloudId,\n                method: 'DELETE',\n                headers: $rootScope.headers\n            }).then(function (response) {\n                if (response.status == 204) {\n                    alert('操作成功');\n                    $scope.cloudHost.splice(index, 1);\n                }\n            }, function (response) {\n                alert(response.statusText);\n            });\n        }\n\n    };\n    $scope.restartComputer = function (cloudId, key) { //重启\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"reboot\": {\n                    \"type\": \"HARD\"\n                }\n            }\n        }).then(function (response) {\n            console.log(response);\n            if (response.status == 202) {\n                alert($scope.cloudHost[key].name + '重启成功');\n                $scope['restartComputer' + key] = $interval(function () {\n                    $http({\n                        url: '/api/list_servers/' + cloudId,\n                        method: 'GET',\n                        headers: $rootScope.headers\n                    }).then(function (success) {\n                        console.log(success);\n                        var data = success.data.server;\n                        resetState($scope.cloudHost[key], data);\n                        if (data['OS-EXT-STS:task_state'] == null) {\n                            $interval.cancel($scope['restartComputer' + key]);\n                            $scope['restartComputer' + key] = null;\n                        }\n                    }, function (error) {\n                        alert(error.statusText);\n                    });\n                }, 1000);\n            }\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n    $scope.all_check = false; //全选按钮状态\n    $scope.allCheck = function (status) { //父选项\n        all_check_service.allCheck(status, $scope.cloudHost);\n    };\n    $scope.itemCheck = function () { //子选项\n        all_check_service.itemCheck($scope, $scope.cloudHost);\n    };\n\n    $scope.changeConfig = function () { //进度条\n        $scope.coresChangeProgress = $scope.newConfig.vcpus - $scope.oldConfig.vcpus;\n        $scope.ramChangeProgress = $scope.newConfig.ram / 1024 - $scope.oldConfig.ram / 1024;\n        $scope.showConfig = $scope.newConfig;\n    };\n    $scope.resetConfigInfo = function (info, key) { //调整配置弹框\n        $scope.newConfig = ''; //初始化云主机类型选择项\n        $scope.coresChangeProgress = 0; //初始化进度条\n        $scope.ramChangeProgress = 0; //初始化进度条\n        $scope.canSelectFlavors = angular.copy($rootScope.flavors); //深拷贝云主机类型\n        $scope.canSelectFlavors.splice(reachFloverIndex(info.flavor.id), 1); //除去现在的配置类型方便用户选择\n        $scope.showConfig = info.flavor;//初始化方案详情表格\n        $scope.cloudId = info.id;//当前操作云主机Id\n        $scope.oldConfig = info.flavor; //旧配置类型\n        $scope.key = key; //获取当前操作的index\n        count_service.getCount(); //获取最新的云主机使用情况\n    };\n    $scope.submitConfig = function () { //修改配置提交\n        console.log($scope.cloudId);\n        console.log($scope.newConfig);\n        console.log($scope.diskConfig);\n        $http({  //调整配置提交\n            url: '/api/server_action/' + $scope.cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"resize\": {\n                    \"flavorRef\": $scope.newConfig.id,\n                    \"OS-DCF:diskConfig\": $scope.diskConfig\n                }\n            }\n\n        }).then(function (response) {\n            console.log(response);\n            $('#reset_config').modal('hide');\n\n            $scope.intervalConfig = $interval(function () { //提交调整配置后监听状态\n                $http({\n                    url: '/api/list_servers/' + $scope.cloudId,\n                    method: 'GET',\n                    headers: $rootScope.headers\n                }).then(function (success) {\n                    console.log(success);\n                    var data = success.data.server;\n                    resetState($scope.cloudHost[$scope.key], data);//更新任务状态\n                    $scope.cloudHost[$scope.key].flavor = reachFlover(data); //更新配置\n                    if (data['OS-EXT-STS:task_state'] == null) {\n                        $interval.cancel($scope.intervalConfig);\n                        $scope.intervalConfig = null;\n                    }\n                }, function (error) {\n                    alert(error.statusText);\n                });\n            }, 1000);\n\n        }, function (response) {\n            alert(response.statusText);\n        });\n\n    };\n    $scope.confirmConfig = function (cloudId, key) { //确认迁移\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"confirmResize\": null\n            }\n        }).then(function (response) {\n            console.log(response);\n            $scope.intervalConfirmConfig = $interval(function () {\n                $http({\n                    url: '/api/list_servers/' + cloudId,\n                    method: 'GET',\n                    headers: $rootScope.headers\n                }).then(function (success) {\n                    console.log(success);\n                    var data = success.data.server;\n                    resetState($scope.cloudHost[key], data);\n                    if (data['OS-EXT-STS:vm_state'] == \"stopped\") {\n                        $interval.cancel($scope.intervalConfirmConfig);\n                        $scope.intervalConfirmConfig = null;\n                        $state.go('count.cloudComputer', {}, {reload: true});\n                    }\n                }, function (error) {\n                    alert(error.statusText);\n                });\n            }, 1000);\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n\n    $scope.returnConfig = function (cloudId, key) {  //回退配置\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"revertResize\": null\n            }\n        }).then(function (response) {\n            console.log(response);\n            $state.go('count.cloudComputer', {}, {reload: true});\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n    $scope.reconstruction = function (cloudId, key) { //重建云主机获取当前操作云主机ID\n        $scope.cloudId = cloudId;//当前操作云主机Id\n        $scope.key = key;\n        console.log($scope.key);\n        $scope.selectImage = '';\n    };\n\n    $scope.submitResetCloudComputer = function () { //重建云主机\n        console.log($scope.selectImage);\n        $http({\n            url: '/api/server_action/' + $scope.cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"rebuild\": {\n                    \"imageRef\": $scope.selectImage\n                }\n            }\n        }).then(function (response) {\n            console.log(response);\n            if (response.status == 202) {\n                $('#reset_cloud_computer').modal('hide');\n                reachImage($scope.cloudHost[$scope.key], $scope.selectImage);\n                $scope.intervalReconstruction = $interval(function () {\n                    $http({\n                        url: '/api/list_servers/' + $scope.cloudId,\n                        method: 'GET',\n                        headers: $rootScope.headers\n                    }).then(function (success) {\n                        console.log(success);\n                        var data = success.data.server;\n                        resetState($scope.cloudHost[$scope.key], data);\n\n                        if (data['OS-EXT-STS:task_state'] == null) {\n                            $interval.cancel($scope.intervalReconstruction);\n                            $scope.intervalReconstruction = null;\n                        }\n                    }, function (error) {\n                        alert(error.statusText);\n                    });\n                }, 1000);\n            }\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n\n    $scope.showCloud = function (cloud_name) { //根据搜索内容显示隐藏\n        if ($scope.searchCloud) {\n            if (cloud_name.indexOf($scope.searchCloud) != -1) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            return true;\n        }\n    };\n\n    $scope.toggleComputer = function (status, cloudId, key, name) { //开关机切换\n        var keystr = \"os-\" + status;\n        var json = {};\n        json[keystr] = null;\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: json\n        }).then(function (success) {\n            console.log(success);\n            $scope['intervalToggle' + key] = $interval(function () {\n                $http({\n                    url: '/api/list_servers/' + cloudId,\n                    method: 'GET',\n                    headers: $rootScope.headers\n                }).then(function (success) {\n                    console.log(success);\n                    var data = success.data.server;\n                    resetState($scope.cloudHost[key], data);\n                    if (data['OS-EXT-STS:task_state'] == null) {\n                        $interval.cancel($scope['intervalToggle' + key]);\n                        $scope['intervalToggle' + key] = null;\n                    }\n                }, function (error) {\n                    alert(error.statusText);\n                });\n            }, 1000);\n        }, function (error) {\n            alert(error.statusText);\n        });\n    };\n}]);\n"]}