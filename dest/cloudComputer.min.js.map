{"version":3,"sources":["../js/controller/cloudComputer.js"],"names":["private_cloud","controller","$scope","$state","$sce","$rootScope","$http","all_check_service","$q","$timeout","$window","$interval","$location","count_service","images_service","resetState","obj","data","vm","state","text","vm_state","task","task_state","power","power_state","reachImage","imageId","angular","forEach","images","value","key","id","imageName","name","reachFlover","i","flavors","length","flavor","url","path","getCount","searchCloud","warn","warnText","building","active","rescued","paused","suspended","stopped","soft_deleted","hard_deleted","resized","error","null","image_snapshotting","image_backingup","pausing","unpausing","suspending","resuming","deleting","stopping","starting","rescuing","unrescuing","rebuilding","powering_on","powering_off","resizing","resize_confirming","scheduling","block_device_mapping","networking","spawning","reboot_started_hard","rebuild_spawning","powering-off","resize_finish","resize_reverting","resize_migrated","resize_migrating","0","1","3","4","6","7","cloudHost","getImages","images_promise","promise","then","response","method","headers","servers","console","log","item","ipData","addresses","push","image","os-getVNCConsole","type","vnc","alert","statusText","success","server","cancel","$on","ngRepeatFinishedEvent","$","popover","html","content","vcpus","ram","disk","deleteCloud","cloudId","index","confirm","status","splice","restartComputer","reboot","all_check","allCheck","itemCheck","changeConfig","newConfig","coresChangeProgress","oldConfig","ramChangeProgress","showConfig","resetConfigInfo","info","canSelectFlavors","copy","flavorId","reachFloverIndex","submitConfig","diskConfig","resize","flavorRef","OS-DCF:diskConfig","modal","intervalConfig","confirmConfig","confirmResize","intervalConfirmConfig","go","reload","returnConfig","revertResize","reconstruction","selectImage","submitResetCloudComputer","rebuild","imageRef","intervalReconstruction","showCloud","cloud_name","indexOf","toggleComputer","json"],"mappings":"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","file":"cloudComputer.min.js","sourcesContent":["/**\n * Created by chenzhongying on 2018/1/5.\n */\nprivate_cloud.controller('cloudComputerController', ['$scope', '$state', '$sce', '$rootScope', '$http', 'all_check_service', '$q', '$timeout', '$window', '$interval', '$location', 'count_service','images_service', function ($scope, $state, $sce, $rootScope, $http, all_check_service, $q, $timeout, $window, $interval, $location, count_service,images_service) {\n    $scope.url = $location.path();\n    count_service.getCount();//主要获取云主机总数\n    $scope.searchCloud = ''; //搜索内容\n    $scope.warn = false;//警告框\n    $scope.warnText = [];//警告文字\n    $scope.vm_state = { //云主机状态\n        building: '创建中',\n        active: '运行中',\n        rescued: '灾备运行',\n        paused: '暂停',\n        suspended: '挂起',\n        stopped: '停止',\n        soft_deleted: '软删除',\n        hard_deleted: '应删除',\n        resized: '确认/回退(调整配置)? ',\n        error: '错误'\n    };\n    $scope.task_state = { //任务\n        null: '无',\n        building: '孵化',\n        image_snapshotting: '正在创建快照',\n        image_backingup: '备份',\n        pausing: '暂停',\n        unpausing: '暂停恢复',\n        suspending: '正在挂起',\n        resuming: '挂起恢复',\n        deleting: '正在删除',\n        stopping: '正在停止',\n        starting: '正在启动',\n        rescuing: '灾难恢复',\n        unrescuing: '灾难复原',\n        rebuilding: '正在重建',\n        powering_on: '打开电源',\n        powering_off: '关闭电源',\n        resizing: '调整配置',\n        resize_confirming: '配置调整确认',\n        scheduling: '调度',\n        block_device_mapping: '块设备映射',\n        networking: '网络映射',\n        spawning: '正在生成',\n        reboot_started_hard: '正在重启',\n        rebuild_spawning: '重建孵化中',\n        \"powering-off\": '正在关闭电源',\n        resize_finish: '已经重建',\n        resize_reverting: '调整撤销中',\n        \"resize_migrated\": '调整配置完毕',\n        \"resize_migrating\": '正在调整配置'\n    };\n    $scope.power_state = { //电池状态\n        0: '无',\n        1: '运行中',\n        3: '暂停',\n        4: '关闭',\n        6: '崩溃',\n        7: '挂起'\n    };\n    $scope.cloudHost = [];//云主机列表\n    function resetState(obj, data) { //更新数据\n        obj.vm = { //云主机状态\n            state: data['OS-EXT-STS:vm_state'],\n            text: $scope.vm_state[data['OS-EXT-STS:vm_state']]\n        };\n        obj.task = { //任务状态\n            state: data['OS-EXT-STS:task_state'],\n            text: $scope.task_state[data['OS-EXT-STS:task_state']]\n        };\n        obj.power = { //电源状态\n            state: data['OS-EXT-STS:power_state'],\n            text: $scope.power_state[data['OS-EXT-STS:power_state']]\n        };\n    }\n\n    function reachImage(obj, imageId) { //查找镜像名称\n        angular.forEach($scope.images, function (value, key) {\n            if (imageId == value.id) {\n                obj.imageName = value.name; //镜像名称\n            }\n        });\n    }\n\n    function reachFlover(obj) {  //查找配置\n        for (var i = 0; i < $rootScope.flavors.length; i++) {\n            if ($rootScope.flavors[i].id == obj.flavor.id) {\n                return $rootScope.flavors[i]; //配置\n            }\n        }\n    }\n\n    function reachFloverIndex(flavorId) {  //查找配置类型在数据中的位置\n        for (var i = 0; i < $rootScope.flavors.length; i++) {\n            if ($rootScope.flavors[i].id == flavorId) {\n                return i; //返回坐标\n            }\n        }\n    }\n    images_service.getImages();\n    $rootScope.images_promise.promise.then(function (response) { //获取镜像之后执行\n        $scope.images = response.data.images;\n        $http({\n            url: \"/api/list_servers/detail\", //获取云主机列表\n            method: 'GET',\n            headers: $rootScope.headers\n        }).then(function (response) {\n            var data = response.data.servers;\n            console.log(data);\n            angular.forEach(data, function (value, key) {\n                var item = {};\n                item.ipData = [];\n                angular.forEach(value.addresses, function (value, key) { //获取IP\n                    angular.forEach(value, function (value, key) {\n                        console.log(value);\n                        item.ipData.push(value);\n                    });\n                });\n                item.flavor = reachFlover(value); //配置类型\n                item.name = value.name; //云主机名称\n                item.id = value.id; //云主机id\n                var imageId = value.image.id; //镜像ID\n                resetState(item, value); //获取任务状态\n                reachImage(item, imageId); //查找备份名称\n\n                if (value['OS-EXT-STS:task_state'] == null) {\n                    $http({ //获取vnc地址\n                        url: '/api/server_action/' + value.id,\n                        method: 'POST',\n                        headers: $rootScope.headers,\n                        data: {\n                            \"os-getVNCConsole\": {\n                                \"type\": \"novnc\"\n                            }\n                        }\n\n                    }).then(function (response) {\n                        item.vnc = response.data.console.url;\n                    }, function (response) {\n                        alert(response.statusText);\n                    });\n\n                }\n\n                $scope.cloudHost.push(item);\n\n                if (value['OS-EXT-STS:task_state'] != null) { //如果有任务正在执行那就要监听这个任务状态\n                    $scope['intervalInit' + key] = $interval(function () {\n                        $http({\n                            url: '/api/list_servers/' + item.id,\n                            method: 'GET',\n                            headers: $rootScope.headers\n                        }).then(function (success) {\n                            console.log(success);\n                            var data = success.data.server;\n                            resetState($scope.cloudHost[key], data); //更新任务状态\n                            $scope.cloudHost[key].flavor = reachFlover(data); //更新配置\n                            if (data['OS-EXT-STS:task_state'] == null) {\n                                $scope.cloudHost[key].ipData = []; //IP地址初始化\n                                $scope.cloudHost[key].vnc = ''; //vnc地址初始化\n                                angular.forEach(data.addresses, function (value) { //获取IP\n                                    angular.forEach(value, function (value) {\n                                        $scope.cloudHost[key].ipData.push(value);\n                                        console.log($scope.cloudHost[key].ipData);\n                                    });\n                                });\n                                $interval.cancel($scope['intervalInit' + key]);\n                                $scope['intervalInit' + key] = null;\n                                $http({ //获取vnc地址\n                                    url: '/api/server_action/' + value.id,\n                                    method: 'POST',\n                                    headers: $rootScope.headers,\n                                    data: {\n                                        \"os-getVNCConsole\": {\n                                            \"type\": \"novnc\"\n                                        }\n                                    }\n\n                                }).then(function (response) {\n                                    $scope.cloudHost[key].vnc = response.data.console.url;\n                                }, function (response) {\n                                    alert(response.statusText);\n                                });\n                            }\n                        }, function (error) {\n                            alert(error.statusText);\n                        });\n                    }, 1000);\n                }\n                $scope.$on('ngRepeatFinished', function (ngRepeatFinishedEvent) {\n                    //you also get the actual event object\n                    //do stuff, execute functions -- whatever...\n                    $('#config' + key).popover({\n                        html: true,\n                        content: '<table class=\"table table-bordered table-striped table-condensed\">' +\n                        '<tbody>' +\n                        '<tr>' +\n                        '<td width=\"100px\">VCPUs</td>' +\n                        '<td width=\"100px\">' + item.flavor.vcpus +\n                        '</td>' +\n                        '</tr>' +\n                        '<tr>' +\n                        '<td>内存</td>' +\n                        '<td>' + item.flavor.ram / 1024 + '</td>' +\n                        '</tr>' +\n                        '<tr>' +\n                        '<td>大小</td>' +\n                        '<td>' + item.flavor.disk + '</td>' +\n                        '</tr>' +\n                        '</tbody>' +\n                        '</table>'\n                    });\n                });\n            });\n        }, function (response) {\n            alert(response.statusText);\n        });\n\n    });\n\n\n    $scope.deleteCloud = function (cloudId, name, index) { //删除云主机\n        if (confirm('您确定删除' + name + '吗？此操作不可恢复！')) {\n            $http({\n                url: '/api/list_servers/' + cloudId,\n                method: 'DELETE',\n                headers: $rootScope.headers\n            }).then(function (response) {\n                if (response.status == 204) {\n                    alert('操作成功');\n                    $scope.cloudHost.splice(index, 1);\n                }\n            }, function (response) {\n                alert(response.statusText);\n            });\n        }\n\n    };\n    $scope.restartComputer = function (cloudId, key) { //重启\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"reboot\": {\n                    \"type\": \"HARD\"\n                }\n            }\n        }).then(function (response) {\n            console.log(response);\n            if (response.status == 202) {\n                alert($scope.cloudHost[key].name + '重启成功');\n                $scope['restartComputer' + key] = $interval(function () {\n                    $http({\n                        url: '/api/list_servers/' + cloudId,\n                        method: 'GET',\n                        headers: $rootScope.headers\n                    }).then(function (success) {\n                        console.log(success);\n                        var data = success.data.server;\n                        resetState($scope.cloudHost[key], data);\n                        if (data['OS-EXT-STS:task_state'] == null) {\n                            $interval.cancel($scope['restartComputer' + key]);\n                            $scope['restartComputer' + key] = null;\n                        }\n                    }, function (error) {\n                        alert(error.statusText);\n                    });\n                }, 1000);\n            }\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n    $scope.all_check = false; //全选按钮状态\n    $scope.allCheck = function (status) { //父选项\n        all_check_service.allCheck(status, $scope.cloudHost);\n    };\n    $scope.itemCheck = function () { //子选项\n        all_check_service.itemCheck($scope, $scope.cloudHost);\n    };\n\n    $scope.changeConfig = function () { //进度条\n        if($scope.newConfig){\n            $scope.coresChangeProgress = $scope.newConfig.vcpus - $scope.oldConfig.vcpus;\n            $scope.ramChangeProgress = $scope.newConfig.ram / 1024 - $scope.oldConfig.ram / 1024;\n            $scope.showConfig = $scope.newConfig;\n        }else{\n            $scope.showConfig = $scope.oldConfig;\n            $scope.coresChangeProgress = 0;\n            $scope.ramChangeProgress = 0;\n        }\n    };\n    $scope.resetConfigInfo = function (info, key) { //调整配置弹框\n        $scope.newConfig = ''; //初始化云主机类型选择项\n        $scope.coresChangeProgress = 0; //初始化进度条\n        $scope.ramChangeProgress = 0; //初始化进度条\n        $scope.canSelectFlavors = angular.copy($rootScope.flavors); //深拷贝云主机类型\n        $scope.canSelectFlavors.splice(reachFloverIndex(info.flavor.id), 1); //除去现在的配置类型方便用户选择\n        $scope.showConfig = info.flavor;//初始化方案详情表格\n        $scope.cloudId = info.id;//当前操作云主机Id\n        $scope.oldConfig = info.flavor; //旧配置类型\n        $scope.key = key; //获取当前操作的index\n        count_service.getCount(); //获取最新的云主机使用情况\n    };\n    $scope.submitConfig = function () { //修改配置提交\n        console.log($scope.cloudId);\n        console.log($scope.newConfig);\n        console.log($scope.diskConfig);\n        $http({  //调整配置提交\n            url: '/api/server_action/' + $scope.cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"resize\": {\n                    \"flavorRef\": $scope.newConfig.id,\n                    \"OS-DCF:diskConfig\": $scope.diskConfig\n                }\n            }\n\n        }).then(function (response) {\n            console.log(response);\n            $('#reset_config').modal('hide');\n\n            $scope.intervalConfig = $interval(function () { //提交调整配置后监听状态\n                $http({\n                    url: '/api/list_servers/' + $scope.cloudId,\n                    method: 'GET',\n                    headers: $rootScope.headers\n                }).then(function (success) {\n                    console.log(success);\n                    var data = success.data.server;\n                    resetState($scope.cloudHost[$scope.key], data);//更新任务状态\n                    $scope.cloudHost[$scope.key].flavor = reachFlover(data); //更新配置\n                    if (data['OS-EXT-STS:task_state'] == null) {\n                        $interval.cancel($scope.intervalConfig);\n                        $scope.intervalConfig = null;\n                    }\n                }, function (error) {\n                    alert(error.statusText);\n                });\n            }, 1000);\n\n        }, function (response) {\n            alert(response.statusText);\n        });\n\n    };\n    $scope.confirmConfig = function (cloudId, key) { //确认迁移\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"confirmResize\": null\n            }\n        }).then(function (response) {\n            console.log(response);\n            $scope.intervalConfirmConfig = $interval(function () {\n                $http({\n                    url: '/api/list_servers/' + cloudId,\n                    method: 'GET',\n                    headers: $rootScope.headers\n                }).then(function (success) {\n                    console.log(success);\n                    var data = success.data.server;\n                    resetState($scope.cloudHost[key], data);\n                    if (data['OS-EXT-STS:vm_state'] == \"stopped\") {\n                        $interval.cancel($scope.intervalConfirmConfig);\n                        $scope.intervalConfirmConfig = null;\n                        $state.go('count.cloudComputer', {}, {reload: true});\n                    }\n                }, function (error) {\n                    alert(error.statusText);\n                });\n            }, 1000);\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n\n    $scope.returnConfig = function (cloudId, key) {  //回退配置\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"revertResize\": null\n            }\n        }).then(function (response) {\n            console.log(response);\n            $state.go('count.cloudComputer', {}, {reload: true});\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n    $scope.reconstruction = function (cloudId, key) { //重建云主机获取当前操作云主机ID\n        $scope.cloudId = cloudId;//当前操作云主机Id\n        $scope.key = key;\n        console.log($scope.key);\n        $scope.selectImage = '';\n    };\n\n    $scope.submitResetCloudComputer = function () { //重建云主机\n        console.log($scope.selectImage);\n        $http({\n            url: '/api/server_action/' + $scope.cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: {\n                \"rebuild\": {\n                    \"imageRef\": $scope.selectImage\n                }\n            }\n        }).then(function (response) {\n            console.log(response);\n            if (response.status == 202) {\n                $('#reset_cloud_computer').modal('hide');\n                reachImage($scope.cloudHost[$scope.key], $scope.selectImage);\n                $scope.intervalReconstruction = $interval(function () {\n                    $http({\n                        url: '/api/list_servers/' + $scope.cloudId,\n                        method: 'GET',\n                        headers: $rootScope.headers\n                    }).then(function (success) {\n                        console.log(success);\n                        var data = success.data.server;\n                        resetState($scope.cloudHost[$scope.key], data);\n\n                        if (data['OS-EXT-STS:task_state'] == null) {\n                            $interval.cancel($scope.intervalReconstruction);\n                            $scope.intervalReconstruction = null;\n                        }\n                    }, function (error) {\n                        alert(error.statusText);\n                    });\n                }, 1000);\n            }\n        }, function (response) {\n            alert(response.statusText);\n        });\n    };\n\n    $scope.showCloud = function (cloud_name) { //根据搜索内容显示隐藏\n        if ($scope.searchCloud) {\n            if (cloud_name.indexOf($scope.searchCloud) != -1) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            return true;\n        }\n    };\n\n    $scope.toggleComputer = function (status, cloudId, key, name) { //开关机切换\n        var keystr = \"os-\" + status;\n        var json = {};\n        json[keystr] = null;\n        $http({\n            url: '/api/server_action/' + cloudId,\n            method: 'POST',\n            headers: $rootScope.headers,\n            data: json\n        }).then(function (success) {\n            console.log(success);\n            $scope['intervalToggle' + key] = $interval(function () {\n                $http({\n                    url: '/api/list_servers/' + cloudId,\n                    method: 'GET',\n                    headers: $rootScope.headers\n                }).then(function (success) {\n                    console.log(success);\n                    var data = success.data.server;\n                    resetState($scope.cloudHost[key], data);\n                    if (data['OS-EXT-STS:task_state'] == null) {\n                        $interval.cancel($scope['intervalToggle' + key]);\n                        $scope['intervalToggle' + key] = null;\n                    }\n                }, function (error) {\n                    alert(error.statusText);\n                });\n            }, 1000);\n        }, function (error) {\n            alert(error.statusText);\n        });\n    };\n}]);\n"]}