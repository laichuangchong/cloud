/*! cloud - v1.0.0 - 2018-03-05 */
private_cloud.controller("backupsController", [ "$scope", "$state", "$rootScope", "$http", "all_check_service", "cloud_service", "$timeout", function(e, t, a, o, c, l, n) {
    e.backups = [], l.getCloud(), a.cloud_promise.promise.then(function(t) {
        console.log(t), e.clouds = t.data.servers, o({
            url: "/api/list_images/detail",
            headers: a.headers
        }).then(function(t) {
            console.log(t), angular.forEach(t.data.images, function(t, a) {
                if ("snapshot" == t.metadata.image_type || "backup" == t.metadata.image_type) {
                    var o = t;
                    angular.forEach(e.clouds, function(e, a) {
                        e.id == t.server.id && (o.cloudName = e.name);
                    }), e.backups.push(t);
                }
            });
        }, function(e) {
            alert(e.statusText);
        });
    }), e.all_check = !1, console.log(e.all_check), e.allCheck = function(t) {
        c.allCheck(t, e.hostList);
    }, e.itemCheck = function() {
        c.itemCheck(e);
    }, e.deleteBase = function(t, c, l) {
        confirm("确定删除" + t + "吗？这个动作不能撤消哦") && o({
            url: "/api/list_images/" + c,
            method: "DELETE",
            headers: a.headers
        }).then(function(t) {
            console.log(t), alert("删除成功"), e.backups.splice(l, 1);
        }, function(e) {
            alert(e.statusText);
        });
    }, e.formSubmit = function(c) {
        c.preventDefault(), o({
            url: "/api/server_action/" + e.selectCloud,
            method: "POST",
            headers: a.headers,
            data: {
                createBackup: {
                    name: e.backupName,
                    backup_type: "daily",
                    rotation: 1
                }
            }
        }).then(function(e) {
            console.log(e), $("#creat_backup").modal("hide"), n(function() {
                t.go("count.backups", {}, {
                    reload: !0
                });
            }, 1e3);
        }, function(e) {
            alert(e.statusText);
        });
    };
} ]);
//# sourceMappingURL=backups.min.js.map